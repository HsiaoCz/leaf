# leaf

一个类似于掘金的知识分享社区

### 功能实现的一些想法

1、用户注册,支持使用邮件或者手机号码注册

这里注册，也支持使用别的服务授权，例如 github
也就是所谓的 Oauth2.0

注册的时候，用户可以通过手机号注册，或者密码注册
两者可以选其一，但是手机号和邮箱都需要通过验证码验证

用户注册后即登录，会返回一个 Token

用户注册后，会使用生成的 Identity 作为用户的默认用户名，返回静态资源库里的一张随机图片作为用户的默认头像

这里产生了几个问题？

1、怎么实现给用户的手机号发送验证码？这个问题的前提是需要判断用户的手机号是有效的。如果无效怎么办？

无效直接返回错误信息就可以了，手机号发验证码的 API 有错误产生吗？
怎么生成验证码的问题？
这个很简单，使用 6 位的随机数即可

2、怎么给用户的邮箱发送验证码？前提是用户的邮箱是有效的

这个之前实现过，需要注意的是发验证码的邮箱需要开个什么东西

3、生成用户 ID 的问题？

这里使用雪花算法生成用户 ID
那么怎么生成文章 ID 呢？

4、怎么返回图片文件？
怎么实现返回静态资源文件列表里的某张随机图片？

这里的前提，我们提供几张图片，作为用户登录后的默认头像
这里图片以 default 作为前缀，加上编号，放在静态资源的 images 列表里面

有两种方式：

后端实现：由后端代码随机选一张发过去
前端实现：前端在用户注册完成时候生成一个在图片里随机选一张发过来然后后端将前端选的这张图片发过去

这里就使用后端实现

有一个问题：

用户如果不更改头像，那么每次用户登录，我们应该继续返回这张图片

如果用户修改了头像，我们就不应该继续返回这张图片了

所以怎么实现这个效果了？

当我们返回给用户一张图片后，我们在 redis 里面记录一下用户的这个头像，使用 userid:image 作为 key，图片的名称作为 value
,当用户更换头像后，就覆盖这个 key

这里感觉不如直接在数据库里开个字段存用户的头像信息

还有一个问题：

用户注册成功后，可以修改自己的用户名，等等信息，这里要不要把修改头像也放在一起

这里我觉得不该放在一起，需要分开来做，更换头像是一个单独的请求

-- 新发现

这个头像功能应该前端实现
如果后端实现，那么返回给前端还得再存到静态资源列表里面
前端从静态资源列表里面返回几张默认头像中的一张作为用户的默认头像
当用户修改头像，前端将头像存到静态资源列表里的用户头像列表里面

但是还存在一个问题，前端怎么知道图片是那张呢？
感觉这里还是需要后端来配合完成这个功能

这里需要在用户表里面加一个字段，用来记录用户的头像的图片名称，或许还需要一个字段来记录图片的后缀

2、登录，支持使用三方登录，或者使用邮箱或者手机号的验证码登录
